\hypertarget{map_8h_source}{}\doxysection{map.\+h}
\label{map_8h_source}\index{src/map.h@{src/map.h}}
\mbox{\hyperlink{map_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{engine_8h}{engine.h}}"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}engine/log.h"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external__include_8h}{external\_include.h}}"{}}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{entityhelper_8h}{entityhelper.h}}"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{level__info_8h}{level\_info.h}}"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{remote__player_8h}{remote\_player.h}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{statemanager_8h}{statemanager.h}}"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_map}{Map}}\ \{}
\DoxyCodeLine{00015\ \ \ \ \ \mbox{\hyperlink{struct_lobby_map_info}{LobbyMapInfo}}\ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}};}
\DoxyCodeLine{00016\ \ \ \ \ \mbox{\hyperlink{struct_game_map_info}{GameMapInfo}}\ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}};}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \ \ \ \ std::vector<std::shared\_ptr<RemotePlayer>>\ \mbox{\hyperlink{struct_map_af01ceb7d11591c11566e7b8d0138b0c6}{remote\_players\_NOT\_SERIALIZED}};}
\DoxyCodeLine{00019\ \ \ \ \ std::string\ \mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}};}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \ \ \ \ \mbox{\hyperlink{struct_map_a6c12f320da33483abab1e7133152ef3b}{Map}}(\textcolor{keyword}{const}\ std::string\&\ \_seed\ =\ \textcolor{stringliteral}{"{}default\_seed"{}})\ :\ \mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}}(\_seed)\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO\ this\ is\ needed\ for\ the\ items\ to\ be\ regenerated}}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_a4e98fd60043de56a87546304f6ac1f01}{update\_seed}}(\mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}});}
\DoxyCodeLine{00024\ \ \ \ \ \}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a4e98fd60043de56a87546304f6ac1f01}{update\_seed}}(\textcolor{keyword}{const}\ std::string\&\ s)\ \{\ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_game_map_info_a3e6cb1b5e1429089bb8d3498562854b3}{update\_seed}}(s);\ \}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \mbox{\hyperlink{item__helper_8h_a175a25f0a9aa01587d97b5daefa2db13}{Items}}\ \mbox{\hyperlink{struct_map_a020eac8bc34cb0da6f978b410913f82f}{items}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}()\ ?\ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_acf7cf891676017e69d101bc6c164fa45}{items}}\ :\ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_acf7cf891676017e69d101bc6c164fa45}{items}};}
\DoxyCodeLine{00030\ \ \ \ \ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}}\ \mbox{\hyperlink{struct_map_ab6633a39aa81ed9161458051d0b0e662}{entities}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}()\ ?\ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_ac9ac8f187c4e95277137ff7d38a5efe4}{entities}}\ :\ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_ac9ac8f187c4e95277137ff7d38a5efe4}{entities}};}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a0d162dc968a2d18848e241c8c7f9e865}{onUpdate}}(\textcolor{keywordtype}{float}\ dt)\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ TRACY\_ZONE\_SCOPED;}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ rp\ :\ \mbox{\hyperlink{struct_map_af01ceb7d11591c11566e7b8d0138b0c6}{remote\_players\_NOT\_SERIALIZED}})\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ rp-\/>update(dt);}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}())\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_ad3f119e5329f5c5f62537ff53fe3b932}{ensure\_generated\_map}}(\mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}});}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_a69320651f4975db03abfcf8979341cb4}{onUpdate}}(dt);}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_ad3f119e5329f5c5f62537ff53fe3b932}{ensure\_generated\_map}}(\mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}});}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_game_map_info_aac456532748e47e912f90269ab54e216}{onUpdate}}(dt);}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a3a0e8d65b69ebda41b8a46516c6ca941}{onDraw}}(\textcolor{keywordtype}{float}\ dt)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ TRACY\_ZONE\_SCOPED;}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ rp\ :\ \mbox{\hyperlink{struct_map_af01ceb7d11591c11566e7b8d0138b0c6}{remote\_players\_NOT\_SERIALIZED}})\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rp)\ rp-\/>render();}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!rp)\ log\_warn(\textcolor{stringliteral}{"{}we\ have\ invalid\ remote\ players"{}});}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}())\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_lobby_map_info_af72bfe92b12587543d0df931323584b3}{onDraw}}(dt);}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_ad4d55937b27ced4254b37e8567d40251}{onDraw}}(dt);}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00061\ \ \ \ \ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a51c107a92c3dcfcbfd39d1e688e80ad3}{onDrawUI}}(\textcolor{keywordtype}{float}\ dt)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ TRACY\_ZONE\_SCOPED;}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}())\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_a29c9081e7343c8fb18e46104f73b957b}{onDrawUI}}(dt);}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_game_map_info_a6f7aefa1a79a33f4ef973f1ef0a4cc87}{onDrawUI}}(dt);}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ GameState::get().is(\mbox{\hyperlink{namespacegame_ae87aa40decbe65eaf21f2d039e7375d6a042abf743ed5406110c31e9c40969748}{game::State::Lobby}})\ ||}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GameState::get().is\_paused\_in(\mbox{\hyperlink{namespacegame_ae87aa40decbe65eaf21f2d039e7375d6a042abf743ed5406110c31e9c40969748}{game::State::Lobby}});}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ These\ are\ called\ before\ every\ "{}send\_map\_state"{}\ when\ server}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ sends\ everything\ over\ to\ clients}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_ab7fed84f8d2c66b12a77c7e8a1584125}{ensure\_generated\_map}}()\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ game\_info.ensure\_generated\_map(seed);}}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a654d7b033c2104b2edecfcf73ffcf887}{grab\_things}}()\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}())\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_a66f640142946bce849c3b1e73884c45e}{grab\_things}}();}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_a66f640142946bce849c3b1e73884c45e}{grab\_things}}();}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00088\ \ \ \ \ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{friend}\ bitsery::Access;}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ S>}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a55250a0fffd3f2d82afd309055cfbc37}{serialize}}(S\&\ s)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ s.object(\mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}});}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ s.object(\mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}});}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ \};}

\end{DoxyCode}
