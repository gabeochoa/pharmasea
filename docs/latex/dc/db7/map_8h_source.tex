\hypertarget{map_8h_source}{}\doxysection{map.\+h}
\label{map_8h_source}\index{src/map.h@{src/map.h}}
\mbox{\hyperlink{map_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{engine_8h}{engine.h}}"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{container__cast_8h}{engine/container\_cast.h}}"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{log_8h}{engine/log.h}}"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external__include_8h}{external\_include.h}}"{}}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{entityhelper_8h}{entityhelper.h}}"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{level__info_8h}{level\_info.h}}"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_map}{Map}}\ \{}
\DoxyCodeLine{00014\ \ \ \ \ \mbox{\hyperlink{struct_lobby_map_info}{LobbyMapInfo}}\ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}};}
\DoxyCodeLine{00015\ \ \ \ \ \mbox{\hyperlink{struct_game_map_info}{GameMapInfo}}\ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}};}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \ \ \ \ std::vector<std::shared\_ptr<Entity>>\ \mbox{\hyperlink{struct_map_a2c8d1bde41515d422382cb9eb42eaad0}{remote\_players\_NOT\_SERIALIZED}};}
\DoxyCodeLine{00018\ \ \ \ \ std::string\ \mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}};}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{comment}{//\ This\ gets\ called\ on\ every\ network\ frame\ because}}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{comment}{//\ the\ serializer\ uses\ the\ default\ contructor}}
\DoxyCodeLine{00022\ \ \ \ \ \mbox{\hyperlink{struct_map_a0f5ad0fd4563497b4214038cbca8b582}{Map}}()\ \{\}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \ \ \ \ \mbox{\hyperlink{struct_map_a326419229ba57b9b286c6501c8d659f6}{Map}}(\textcolor{keyword}{const}\ std::string\&\ \_seed)\ :\ \mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}}(\_seed)\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO\ this\ is\ needed\ for\ the\ items\ to\ be\ regenerated}}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_a4e98fd60043de56a87546304f6ac1f01}{update\_seed}}(\mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}});}
\DoxyCodeLine{00027\ \ \ \ \ \}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a4e98fd60043de56a87546304f6ac1f01}{update\_seed}}(\textcolor{keyword}{const}\ std::string\&\ s)\ \{\ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_game_map_info_a3e6cb1b5e1429089bb8d3498562854b3}{update\_seed}}(s);\ \}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{item__helper_8h_a175a25f0a9aa01587d97b5daefa2db13}{Items}}\ \mbox{\hyperlink{struct_map_a020eac8bc34cb0da6f978b410913f82f}{items}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}()\ ?\ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_acf7cf891676017e69d101bc6c164fa45}{items}}\ :\ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_acf7cf891676017e69d101bc6c164fa45}{items}};}
\DoxyCodeLine{00033\ \ \ \ \ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}}\ \mbox{\hyperlink{struct_map_ab6633a39aa81ed9161458051d0b0e662}{entities}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}()\ ?\ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_ac9ac8f187c4e95277137ff7d38a5efe4}{entities}}\ :\ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_ac9ac8f187c4e95277137ff7d38a5efe4}{entities}};}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a0d162dc968a2d18848e241c8c7f9e865}{onUpdate}}(\textcolor{keywordtype}{float}\ dt)\ \{\ \mbox{\hyperlink{struct_map_a500db02dd4c45b624ca9c6c50de5f0cd}{\_onUpdate}}(\mbox{\hyperlink{struct_map_a2c8d1bde41515d422382cb9eb42eaad0}{remote\_players\_NOT\_SERIALIZED}},\ dt);\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a500db02dd4c45b624ca9c6c50de5f0cd}{\_onUpdate}}(std::vector<std::shared\_ptr<Entity>>\ players,\ \textcolor{keywordtype}{float}\ dt)\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tracy_8h_af0966b1b117a1e09190aaee5d5175e27}{TRACY\_ZONE\_SCOPED}};}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO\ add\ to\ debug\ overlay}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ log\_info("{}num\ items\ \{\}"{},\ items().size());}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}())\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_ad3f119e5329f5c5f62537ff53fe3b932}{ensure\_generated\_map}}(\mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}});}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_afc8cbde7e95c3b3a3c58fc0e7ec8dbb3}{onUpdate}}(players,\ dt);}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_ad3f119e5329f5c5f62537ff53fe3b932}{ensure\_generated\_map}}(\mbox{\hyperlink{struct_map_a4e91cf446c69dc25097b00eded8e61df}{seed}});}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_game_map_info_a05b1ffcf7ce921a2902e60b7938e942a}{onUpdate}}(players,\ dt);}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00053\ \ \ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a3a0e8d65b69ebda41b8a46516c6ca941}{onDraw}}(\textcolor{keywordtype}{float}\ dt)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tracy_8h_af0966b1b117a1e09190aaee5d5175e27}{TRACY\_ZONE\_SCOPED}};}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ SystemManager::get().render\_entities(}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{container__cast_8h_a7b70b5916f605fbbf65bcb67b9679c76}{container\_cast}}(\mbox{\hyperlink{struct_map_a2c8d1bde41515d422382cb9eb42eaad0}{remote\_players\_NOT\_SERIALIZED}},}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}converting\ sp<RemotePlayer>\ to\ sp<Entity>\ as\ these\ "{}}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}are\ not\ serialized\ and\ so\ not\ part\ of\ level\ info"{}}),}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ dt);}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}())\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_lobby_map_info_af72bfe92b12587543d0df931323584b3}{onDraw}}(dt);}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_a7c2985c6599e2a7d5e051cc7f835fc6d}{onDraw}}(dt);}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a51c107a92c3dcfcbfd39d1e688e80ad3}{onDrawUI}}(\textcolor{keywordtype}{float}\ dt)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tracy_8h_af0966b1b117a1e09190aaee5d5175e27}{TRACY\_ZONE\_SCOPED}};}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}())\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_a4831864db4d34ecc1e19a1007dac9ba7}{onDrawUI}}(dt);}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_a4831864db4d34ecc1e19a1007dac9ba7}{onDrawUI}}(dt);}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ GameState::get().is(\mbox{\hyperlink{namespacegame_ae87aa40decbe65eaf21f2d039e7375d6a042abf743ed5406110c31e9c40969748}{game::State::Lobby}})\ ||}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GameState::get().is\_paused\_in(\mbox{\hyperlink{namespacegame_ae87aa40decbe65eaf21f2d039e7375d6a042abf743ed5406110c31e9c40969748}{game::State::Lobby}});}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ These\ are\ called\ before\ every\ "{}send\_map\_state"{}\ when\ server}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ sends\ everything\ over\ to\ clients}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a654d7b033c2104b2edecfcf73ffcf887}{grab\_things}}()\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{struct_map_a9bae0d8ebda54fddd9c2a88dea36f16c}{in\_lobby\_state}}())\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}}.\mbox{\hyperlink{struct_level_info_a66f640142946bce849c3b1e73884c45e}{grab\_things}}();}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}}.\mbox{\hyperlink{struct_level_info_a66f640142946bce849c3b1e73884c45e}{grab\_things}}();}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ TODO\ do\ we\ need\ this}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_ab7fed84f8d2c66b12a77c7e8a1584125}{ensure\_generated\_map}}()\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ game\_info.ensure\_generated\_map(seed);}}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keyword}{friend}\ bitsery::Access;}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ S>}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_map_a55250a0fffd3f2d82afd309055cfbc37}{serialize}}(S\&\ s)\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ s.object(\mbox{\hyperlink{struct_map_ad834d33ba670ece03682ec45ee9bdd65}{lobby\_info}});}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ s.object(\mbox{\hyperlink{struct_map_acdd4795062a0d34623c3afe524b2a150}{game\_info}});}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ \};}

\end{DoxyCode}
