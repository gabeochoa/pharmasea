\hypertarget{entityhelper_8h_source}{}\doxysection{entityhelper.\+h}
\label{entityhelper_8h_source}\index{src/entityhelper.h@{src/entityhelper.h}}
\mbox{\hyperlink{entityhelper_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{assert_8h}{assert.h}}"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external__include_8h}{external\_include.h}}"{}}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{can__be__ghost__player_8h}{components/can\_be\_ghost\_player.h}}"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{can__be__held_8h}{components/can\_be\_held.h}}"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{is__solid_8h}{components/is\_solid.h}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{globals__register_8h}{engine/globals\_register.h}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{is__server_8h}{engine/is\_server.h}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{globals_8h}{globals.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{comment}{//}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{entity_8h}{entity.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{item_8h}{item.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{statemanager_8h}{statemanager.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{comment}{//\ TODO\ eventually\ move\ to\ system\ manager\ but\ for\ now\ has\ to\ be\ in\ here}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ to\ prevent\ circular\ includes}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{comment}{//\ return\ true\ if\ the\ item\ has\ collision\ and\ is\ currently\ collidable}}
\DoxyCodeLine{00025\ [[nodiscard]]\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{entityhelper_8h_af5fa95f4f8a66aa99b729afba587f746}{is\_collidable}}(std::shared\_ptr<Entity>\ entity)\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{comment}{//\ by\ default\ we\ disable\ collisions\ when\ you\ are\ holding\ something}}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{comment}{//\ since\ its\ generally\ inside\ your\ bounding\ box}}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>has<\mbox{\hyperlink{struct_can_be_held}{CanBeHeld}}>())\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !entity-\/>get<\mbox{\hyperlink{struct_can_be_held}{CanBeHeld}}>().is\_held();}
\DoxyCodeLine{00030\ \ \ \ \ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>has<\mbox{\hyperlink{struct_is_solid}{IsSolid}}>())\ \{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00034\ \ \ \ \ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{comment}{//\ if\ you\ are\ a\ ghost\ player\ and\ are\ currently\ not\ a\ ghost}}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{//\ then\ you\ are\ collidable}}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>has<\mbox{\hyperlink{struct_can_be_ghost_player}{CanBeGhostPlayer}}>())\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ entity-\/>get<\mbox{\hyperlink{struct_can_be_ghost_player}{CanBeGhostPlayer}}>().is\_not\_ghost();}
\DoxyCodeLine{00040\ \ \ \ \ \}}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{typedef}\ std::vector<std::shared\_ptr<Entity>>\ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}};}
\DoxyCodeLine{00045\ \textcolor{keyword}{static}\ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}}\ \mbox{\hyperlink{entityhelper_8h_a0615e7b6a0303e4452ecbbaed94def95}{client\_entities\_DO\_NOT\_USE}};}
\DoxyCodeLine{00046\ \textcolor{keyword}{static}\ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}}\ \mbox{\hyperlink{entityhelper_8h_aab3fbb2ee54d9709656c0ac5dbce2c82}{server\_entities\_DO\_NOT\_USE}};}
\DoxyCodeLine{00047\ \textcolor{keyword}{static}\ std::map<vec2,\ bool>\ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_entity_helper}{EntityHelper}}\ \{}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#pragma\ clang\ diagnostic\ push}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#pragma\ clang\ diagnostic\ ignored\ "{}-\/Wdeprecated-\/declarations"{}}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}}\&\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}()\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{is__server_8h_aa9b37672e835e000097b7b8c69868672}{is\_server}}())\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{entityhelper_8h_aab3fbb2ee54d9709656c0ac5dbce2c82}{server\_entities\_DO\_NOT\_USE}};}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Right\ now\ we\ only\ have\ server/client\ thread,\ but\ in\ the\ future\ if\ we}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ have\ more\ then\ we\ should\ check\ these}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ auto\ client\_thread\_id\ =}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ GLOBALS.get\_or\_default("{}client\_thread\_id"{},\ std::thread::id());}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{entityhelper_8h_a0615e7b6a0303e4452ecbbaed94def95}{client\_entities\_DO\_NOT\_USE}};}
\DoxyCodeLine{00063\ \ \ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_a97f17944dd8ed19696573fa9fb34c2b9}{addEntity}}(std::shared\_ptr<Entity>\ e)\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}().push\_back(e);}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (!e-\/>add\_to\_navmesh())\ \{}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ return;}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ auto\ nav\ =\ GLOBALS.get\_ptr<NavMesh>("{}navmesh"{});}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ addShape\ merges\ shapes\ next\ to\ each\ other}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ this\ reduces\ the\ amount\ of\ loops\ overall}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nav-\/>addShape(getPolyForEntity(e));}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nav-\/>addEntity(e-\/>id,\ getPolyForEntity(e));}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cache\_is\_walkable.clear();}}
\DoxyCodeLine{00077\ \ \ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_af410ff8dba7bbba265c4e543c6fd6990}{removeEntity}}(std::shared\_ptr<Entity>\ e)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (e-\/>add\_to\_navmesh())\ \{}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ auto\ nav\ =\ GLOBALS.get\_ptr<NavMesh>("{}navmesh"{});}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nav-\/>removeEntity(e-\/>id);}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cache\_is\_walkable.clear();}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ entities\ =\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}();}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ entities.begin();}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (it\ !=\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}().end())\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*it)-\/>id\ ==\ e-\/>id)\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entities.erase(it);}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ it++;}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ static\ Polygon\ getPolyForEntity(std::shared\_ptr<Entity>\ e)\ \{}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{//\ vec2\ pos\ =\ vec::to2(e-\/>snap\_position());}}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{//\ Rectangle\ rect\ =\ \{}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{comment}{//\ pos.x,}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ pos.y,}}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ TILESIZE,}}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ TILESIZE,}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{comment}{//\ \};}}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{comment}{//\ return\ Polygon(rect);}}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_acc8beb01dd8be784718becdfe5880b62}{cleanup}}()\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cleanup\ entities\ marked\ cleanup}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ entities\ =\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}();}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ entities.begin();}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (it\ !=\ entities.end())\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*it)-\/>cleanup)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entities.erase(it);}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ it++;}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610}{ForEachFlow}}\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610ade35d6cc11c2732bc98475566a7fffe9}{None}}\ =\ 0,}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610a3437d4b32aa4696581e8ee4ed2b53af8}{Continue}}\ =\ 1,}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610a0f3fbeaa77bb603279229e91ec5df0bb}{Break}}\ =\ 2,}
\DoxyCodeLine{00127\ \ \ \ \ \};}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_a61f26ee4774876d30248574c28ba63eb}{forEachEntity}}(}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ std::function<\mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610}{ForEachFlow}}(std::shared\_ptr<Entity>)>\ cb)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tracy_8h_af0966b1b117a1e09190aaee5d5175e27}{TRACY\_ZONE\_SCOPED}};}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ e\ :\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}())\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!e)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fef\ =\ cb(e);}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fef\ ==\ 1)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fef\ ==\ 2)\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::vector<std::shared\_ptr<T>>\ \mbox{\hyperlink{struct_entity_helper_ae92914dda24df2609cd0578075bf3bd4}{getEntitiesInRange}}(}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\ pos,\ \textcolor{keywordtype}{float}\ range)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ std::vector<std::shared\_ptr<T>>\ matching;}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ e\ :\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}())\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ s\ =\ dynamic\_pointer\_cast<T>(e);}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!s)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacevec_a4780c4cb2388d6299519924ca0a609a1}{vec::distance}}(pos,\ e-\/>get<\mbox{\hyperlink{struct_transform}{Transform}}>().\mbox{\hyperlink{struct_transform_aeb1c3da9267cef25c5ece078dbceb849}{as2}}())\ <\ range)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ matching.push\_back(s);}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ matching;}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keyword}{static}\ std::shared\_ptr<T>\ \mbox{\hyperlink{struct_entity_helper_a5cdd24f82a343b41f887186d9b1acf45}{getMatchingEntityInFront}}(}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\ pos,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ range,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_transform_a6afb6367bab2de3b597594c31c2d985d}{Transform::FrontFaceDirection}}\ direction,\ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ std::function<\textcolor{keywordtype}{bool}(std::shared\_ptr<T>)>\ filter\ \ \textcolor{comment}{//}}
\DoxyCodeLine{00160\ \ \ \ \ )\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tracy_8h_af0966b1b117a1e09190aaee5d5175e27}{TRACY\_ZONE\_SCOPED}};}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{assert_8h_a8e93b0cbf5fbae9c583903d9f31ef315}{M\_ASSERT}}(range\ >\ 0,}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fmt::format(\textcolor{stringliteral}{"{}range\ has\ to\ be\ positive\ but\ was\ \{\}"{}},\ range));}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ cur\_step\ =\ 0;}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (cur\_step\ <=\ range)\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tile\ =}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_a3267ca1897b60de8c1543e3846056145}{Entity::tile\_infront\_given\_pos}}(pos,\ cur\_step,\ direction);}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ e\ :\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}())\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ current\_entity\ =\ dynamic\_pointer\_cast<T>(e);}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!current\_entity)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!filter(current\_entity))\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ cur\_dist\ =\ \mbox{\hyperlink{namespacevec_a4780c4cb2388d6299519924ca0a609a1}{vec::distance}}(}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ current\_entity-\/>template\ get<Transform>().as2(),\ tile);}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ outside\ reach}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(cur\_dist)\ >\ 1)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ is\ behind\ us}}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cur\_dist\ <\ 0)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacevec_aa79cdef251ee2f487b55dba93ad63ea0}{vec::to2}}(current\_entity-\/>template\ get<Transform>()}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .snap\_position())\ ==\ \mbox{\hyperlink{namespacevec_a5a3a9e37c6f80541240d5cb6cdb4fd4e}{vec::snap}}(tile))\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ current\_entity;}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ cur\_step++;}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{00190\ \ \ \ \ \}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::shared\_ptr<T>\ \mbox{\hyperlink{struct_entity_helper_a321f609c7e2ac2633d18562edcebb49c}{getClosestMatchingEntity}}(}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\ pos,\ \textcolor{keywordtype}{float}\ range,\ std::function<\textcolor{keywordtype}{bool}(std::shared\_ptr<T>)>\ filter)\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ best\_distance\ =\ range;}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ std::shared\_ptr<T>\ best\_so\_far;}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ e\ :\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}())\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ s\ =\ dynamic\_pointer\_cast<T>(e);}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!s)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!filter(s))\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ d\ =\ \mbox{\hyperlink{namespacevec_a4780c4cb2388d6299519924ca0a609a1}{vec::distance}}(pos,\ e-\/>get<\mbox{\hyperlink{struct_transform}{Transform}}>().\mbox{\hyperlink{struct_transform_aeb1c3da9267cef25c5ece078dbceb849}{as2}}());}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ >\ range)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ <\ best\_distance)\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_so\_far\ =\ s;}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_distance\ =\ d;}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ best\_so\_far;}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{comment}{//\ TODO\ i\ think\ this\ is\ slower\ because\ we\ are\ doing\ "{}outside\ mesh"{}\ as}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{comment}{//\ outside\ we\ should\ probably\ have\ just\ make\ some\ tiles\ for\ inside\ the\ map}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{comment}{//\ ('.'\ on\ map\ for\ example)\ and\ use\ those\ to\ mark\ where\ people\ can\ walk\ and}}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{comment}{//\ where\ they\ cant}}
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{comment}{//\ static\ bool\ isWalkable\_impl(const\ vec2\&\ pos)\ \{}}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{comment}{//\ auto\ nav\ =\ GLOBALS.get\_ptr<NavMesh>("{}navmesh"{});}}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{comment}{//\ if\ (!nav)\ \{}}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{comment}{//\ return\ true;}}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ for\ (auto\ kv\ :\ nav-\/>entityShapes)\ \{}}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{comment}{//\ auto\ s\ =\ kv.second;}}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{comment}{//\ if\ (s.inside(pos))\ return\ false;}}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ return\ true;}}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ TODO\ need\ to\ invalidate\ any\ current\ valid\ paths}}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_ade7521aa6947bb12904da39e3e8df343}{invalidatePathCacheLocation}}(\mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\ pos)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}.erase(pos);}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_a6fef0ba4ee7eaf9d9933c7cacdbb617c}{invalidatePathCache}}()\ \{\ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}.clear();\ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_entity_helper_a4d01c0a143c62ae572e5d4e9eb5711f0}{isWalkable}}(\mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\ pos)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tracy_8h_af0966b1b117a1e09190aaee5d5175e27}{TRACY\_ZONE\_SCOPED}};}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO\ this\ keeps\ crashing\ on\ operator<\ vec2\ for\ segv\ on\ zero\ page}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}.contains(pos))\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ walkable\ =\ \mbox{\hyperlink{struct_entity_helper_a3610c9a5865dc6bfa24cdc6f6858a763}{isWalkableRawEntities}}(pos);}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}[pos]\ =\ walkable;}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}[pos];}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{comment}{//\ each\ target\ get\ and\ path\ find\ runs\ through\ all\ entities}}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{comment}{//\ so\ this\ will\ just\ get\ slower\ and\ slower\ over\ time}}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_entity_helper_a3610c9a5865dc6bfa24cdc6f6858a763}{isWalkableRawEntities}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\&\ pos)\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tracy_8h_af0966b1b117a1e09190aaee5d5175e27}{TRACY\_ZONE\_SCOPED}};}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bounds\ =\ \mbox{\hyperlink{vec__util_8h_a7bc0ade59022f5ab1ebe03a4d6cee6aa}{get\_bounds}}(\{pos.x,\ 0.f,\ pos.y\},\ \{\mbox{\hyperlink{globals_8h_af3c09b249c48587aba215cce49091fa0}{TILESIZE}}\});}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hit\_impassible\_entity\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_a61f26ee4774876d30248574c28ba63eb}{forEachEntity}}([\&](\textcolor{keyword}{auto}\ entity)\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{entityhelper_8h_af5fa95f4f8a66aa99b729afba587f746}{is\_collidable}}(entity)\ \&\&\ entity-\/>collides(bounds))\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hit\_impassible\_entity\ =\ true;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ return\ ForEachFlow::Break;}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610a3437d4b32aa4696581e8ee4ed2b53af8}{ForEachFlow::Continue}};}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !hit\_impassible\_entity;}
\DoxyCodeLine{00260\ \ \ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \textcolor{preprocessor}{\#pragma\ clang\ diagnostic\ pop}}
\DoxyCodeLine{00263\ \};}

\end{DoxyCode}
