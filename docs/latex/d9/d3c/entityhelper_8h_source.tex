\hypertarget{entityhelper_8h_source}{}\doxysection{entityhelper.\+h}
\label{entityhelper_8h_source}\index{src/entityhelper.h@{src/entityhelper.h}}
\mbox{\hyperlink{entityhelper_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}assert.h"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external__include_8h}{external\_include.h}}"{}}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}engine/globals\_register.h"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}engine/is\_server.h"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{globals_8h}{globals.h}}"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{comment}{//}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{entity_8h}{entity.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{item_8h}{item.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{statemanager_8h}{statemanager.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{typedef}\ std::vector<std::shared\_ptr<Entity>>\ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}};}
\DoxyCodeLine{00019\ \textcolor{keyword}{static}\ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}}\ \mbox{\hyperlink{entityhelper_8h_a0615e7b6a0303e4452ecbbaed94def95}{client\_entities\_DO\_NOT\_USE}};}
\DoxyCodeLine{00020\ \textcolor{keyword}{static}\ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}}\ \mbox{\hyperlink{entityhelper_8h_aab3fbb2ee54d9709656c0ac5dbce2c82}{server\_entities\_DO\_NOT\_USE}};}
\DoxyCodeLine{00021\ \textcolor{keyword}{static}\ std::map<vec2,\ bool>\ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}};}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_entity_helper}{EntityHelper}}\ \{}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#pragma\ clang\ diagnostic\ push}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#pragma\ clang\ diagnostic\ ignored\ "{}-\/Wdeprecated-\/declarations"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{entityhelper_8h_a183abbcc97de7f620b2aafb4880e06f7}{Entities}}\&\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}()\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_server())\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{entityhelper_8h_aab3fbb2ee54d9709656c0ac5dbce2c82}{server\_entities\_DO\_NOT\_USE}};}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Right\ now\ we\ only\ have\ server/client\ thread,\ but\ in\ the\ future\ if\ we}}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ have\ more\ then\ we\ should\ check\ these}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ auto\ client\_thread\_id\ =}}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ GLOBALS.get\_or\_default("{}client\_thread\_id"{},\ std::thread::id());}}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{entityhelper_8h_a0615e7b6a0303e4452ecbbaed94def95}{client\_entities\_DO\_NOT\_USE}};}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_a97f17944dd8ed19696573fa9fb34c2b9}{addEntity}}(std::shared\_ptr<Entity>\ e)\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}().push\_back(e);}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!e-\/>add\_to\_navmesh())\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ auto\ nav\ =\ GLOBALS.get\_ptr<NavMesh>("{}navmesh"{});}}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ addShape\ merges\ shapes\ next\ to\ each\ other}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ this\ reduces\ the\ amount\ of\ loops\ overall}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nav-\/>addShape(getPolyForEntity(e));}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nav-\/>addEntity(e-\/>id,\ getPolyForEntity(e));}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cache\_is\_walkable.clear();}}
\DoxyCodeLine{00051\ \ \ \ \ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_af410ff8dba7bbba265c4e543c6fd6990}{removeEntity}}(std::shared\_ptr<Entity>\ e)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (e-\/>add\_to\_navmesh())\ \{}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ auto\ nav\ =\ GLOBALS.get\_ptr<NavMesh>("{}navmesh"{});}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nav-\/>removeEntity(e-\/>id);}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cache\_is\_walkable.clear();}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ entities\ =\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}();}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ entities.begin();}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (it\ !=\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}().end())\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*it)-\/>id\ ==\ e-\/>id)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entities.erase(it);}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ it++;}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ static\ Polygon\ getPolyForEntity(std::shared\_ptr<Entity>\ e)\ \{}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ vec2\ pos\ =\ vec::to2(e-\/>snap\_position());}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{comment}{//\ Rectangle\ rect\ =\ \{}}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ pos.x,}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ pos.y,}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ TILESIZE,}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ TILESIZE,}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ \};}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ return\ Polygon(rect);}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_acc8beb01dd8be784718becdfe5880b62}{cleanup}}()\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cleanup\ entities\ marked\ cleanup}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ entities\ =\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}();}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ entities.begin();}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (it\ !=\ entities.end())\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*it)-\/>cleanup)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entities.erase(it);}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ it++;}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610}{ForEachFlow}}\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610ade35d6cc11c2732bc98475566a7fffe9}{None}}\ =\ 0,}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610a3437d4b32aa4696581e8ee4ed2b53af8}{Continue}}\ =\ 1,}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610a0f3fbeaa77bb603279229e91ec5df0bb}{Break}}\ =\ 2,}
\DoxyCodeLine{00101\ \ \ \ \ \};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_a61f26ee4774876d30248574c28ba63eb}{forEachEntity}}(}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ std::function<\mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610}{ForEachFlow}}(std::shared\_ptr<Entity>)>\ cb)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ TRACY\_ZONE\_SCOPED;}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ e\ :\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}())\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!e)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fef\ =\ cb(e);}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fef\ ==\ 1)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fef\ ==\ 2)\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00112\ \ \ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::vector<std::shared\_ptr<T>>\ \mbox{\hyperlink{struct_entity_helper_ae92914dda24df2609cd0578075bf3bd4}{getEntitiesInRange}}(}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ vec2\ pos,\ \textcolor{keywordtype}{float}\ range)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ std::vector<std::shared\_ptr<T>>\ matching;}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ e\ :\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}())\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ s\ =\ dynamic\_pointer\_cast<T>(e);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!s)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacevec_a4780c4cb2388d6299519924ca0a609a1}{vec::distance}}(pos,\ \mbox{\hyperlink{namespacevec_aa79cdef251ee2f487b55dba93ad63ea0}{vec::to2}}(e-\/>position))\ <\ range)\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ matching.push\_back(s);}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ matching;}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keyword}{static}\ std::shared\_ptr<T>\ \mbox{\hyperlink{struct_entity_helper_a50cbd85165343e46ce2bf545be696f44}{getMatchingEntityInFront}}(}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ vec2\ pos,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ range,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_ad7303705b91fa9ed426096c2bcfd0484}{Entity::FrontFaceDirection}}\ direction,\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ std::function<\textcolor{keywordtype}{bool}(std::shared\_ptr<T>)>\ filter\ \ \textcolor{comment}{//}}
\DoxyCodeLine{00134\ \ \ \ \ )\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ TRACY\_ZONE\_SCOPED;}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ M\_ASSERT(range\ >\ 0,}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fmt::format(\textcolor{stringliteral}{"{}range\ has\ to\ be\ positive\ but\ was\ \{\}"{}},\ range));}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ cur\_step\ =\ 0;}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (cur\_step\ <=\ range)\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tile\ =}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_af454ca504cbb7f3549cc206263895b51}{Entity::tile\_infront\_given\_pos}}(pos,\ cur\_step,\ direction);}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ e\ :\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}())\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ current\_entity\ =\ dynamic\_pointer\_cast<T>(e);}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!current\_entity)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!filter(current\_entity))\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ cur\_dist\ =}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacevec_a4780c4cb2388d6299519924ca0a609a1}{vec::distance}}(\mbox{\hyperlink{namespacevec_aa79cdef251ee2f487b55dba93ad63ea0}{vec::to2}}(current\_entity-\/>position),\ tile);}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ outside\ reach}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(cur\_dist)\ >\ 1)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ is\ behind\ us}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cur\_dist\ <\ 0)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacevec_aa79cdef251ee2f487b55dba93ad63ea0}{vec::to2}}(\mbox{\hyperlink{namespacevec_a5a3a9e37c6f80541240d5cb6cdb4fd4e}{vec::snap}}(current\_entity-\/>position))\ ==}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacevec_a5a3a9e37c6f80541240d5cb6cdb4fd4e}{vec::snap}}(tile))\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ current\_entity;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ cur\_step++;}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\};}
\DoxyCodeLine{00164\ \ \ \ \ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ std::shared\_ptr<T>\ \mbox{\hyperlink{struct_entity_helper_a321f609c7e2ac2633d18562edcebb49c}{getClosestMatchingEntity}}(}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ vec2\ pos,\ \textcolor{keywordtype}{float}\ range,\ std::function<\textcolor{keywordtype}{bool}(std::shared\_ptr<T>)>\ filter)\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ best\_distance\ =\ range;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ std::shared\_ptr<T>\ best\_so\_far;}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ e\ :\ \mbox{\hyperlink{struct_entity_helper_a704ecc99728bb6635523ff9b8e46cd95}{get\_entities}}())\ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ s\ =\ dynamic\_pointer\_cast<T>(e);}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!s)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!filter(s))\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ d\ =\ \mbox{\hyperlink{namespacevec_a4780c4cb2388d6299519924ca0a609a1}{vec::distance}}(pos,\ \mbox{\hyperlink{namespacevec_aa79cdef251ee2f487b55dba93ad63ea0}{vec::to2}}(e-\/>position));}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ >\ range)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ <\ best\_distance)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_so\_far\ =\ s;}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_distance\ =\ d;}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ best\_so\_far;}
\DoxyCodeLine{00183\ \ \ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ TODO\ i\ think\ this\ is\ slower\ because\ we\ are\ doing\ "{}outside\ mesh"{}\ as}}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//\ outside\ we\ should\ probably\ have\ just\ make\ some\ tiles\ for\ inside\ the\ map}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{comment}{//\ ('.'\ on\ map\ for\ example)\ and\ use\ those\ to\ mark\ where\ people\ can\ walk\ and}}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ where\ they\ cant}}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{comment}{//\ static\ bool\ isWalkable\_impl(const\ vec2\&\ pos)\ \{}}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ auto\ nav\ =\ GLOBALS.get\_ptr<NavMesh>("{}navmesh"{});}}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{comment}{//\ if\ (!nav)\ \{}}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{comment}{//\ return\ true;}}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{comment}{//\ for\ (auto\ kv\ :\ nav-\/>entityShapes)\ \{}}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{comment}{//\ auto\ s\ =\ kv.second;}}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ if\ (s.inside(pos))\ return\ false;}}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{comment}{//\ return\ true;}}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{comment}{//\ TODO\ need\ to\ invalidate\ any\ current\ valid\ paths}}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_ade7521aa6947bb12904da39e3e8df343}{invalidatePathCacheLocation}}(vec2\ pos)\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}.erase(pos);}
\DoxyCodeLine{00205\ \ \ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_entity_helper_a6fef0ba4ee7eaf9d9933c7cacdbb617c}{invalidatePathCache}}()\ \{\ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}.clear();\ \}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_entity_helper_a4d01c0a143c62ae572e5d4e9eb5711f0}{isWalkable}}(vec2\ pos)\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ TRACY\_ZONE\_SCOPED;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO\ this\ keeps\ crashing\ on\ operator<\ vec2\ for\ segv\ on\ zero\ page}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}.contains(pos))\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ walkable\ =\ \mbox{\hyperlink{struct_entity_helper_a3610c9a5865dc6bfa24cdc6f6858a763}{isWalkableRawEntities}}(pos);}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}[pos]\ =\ walkable;}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{entityhelper_8h_a4285a99212a3ccfa8dc8ab3198e2e679}{cache\_is\_walkable}}[pos];}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ each\ target\ get\ and\ path\ find\ runs\ through\ all\ entities}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ so\ this\ will\ just\ get\ slower\ and\ slower\ over\ time}}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{struct_entity_helper_a3610c9a5865dc6bfa24cdc6f6858a763}{isWalkableRawEntities}}(\textcolor{keyword}{const}\ vec2\&\ pos)\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ TRACY\_ZONE\_SCOPED;}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ bounds\ =\ \mbox{\hyperlink{vec__util_8h_a7bc0ade59022f5ab1ebe03a4d6cee6aa}{get\_bounds}}(\{pos.x,\ 0.f,\ pos.y\},\ \{\mbox{\hyperlink{globals_8h_af3c09b249c48587aba215cce49091fa0}{TILESIZE}}\});}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hit\_impassible\_entity\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_entity_helper_a61f26ee4774876d30248574c28ba63eb}{forEachEntity}}([\&](\textcolor{keyword}{auto}\ entity)\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>is\_collidable()\ \&\&\ entity-\/>collides(bounds))\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hit\_impassible\_entity\ =\ true;}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ return\ ForEachFlow::Break;}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{struct_entity_helper_ac6cd6e5ff2e336093fbf19980ad27610a3437d4b32aa4696581e8ee4ed2b53af8}{ForEachFlow::Continue}};}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !hit\_impassible\_entity;}
\DoxyCodeLine{00234\ \ \ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \textcolor{preprocessor}{\#pragma\ clang\ diagnostic\ pop}}
\DoxyCodeLine{00237\ \};}

\end{DoxyCode}
