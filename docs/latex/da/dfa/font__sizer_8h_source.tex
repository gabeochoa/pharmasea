\hypertarget{font__sizer_8h_source}{}\doxysection{font\+\_\+sizer.\+h}
\label{font__sizer_8h_source}\index{src/engine/font\_sizer.h@{src/engine/font\_sizer.h}}
\mbox{\hyperlink{font__sizer_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}../preload.h"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{util_8h}{util.h}}"{}}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{comment}{//\ TODO\ is\ there\ a\ better\ way\ to\ do\ this?}}
\DoxyCodeLine{00011\ \textcolor{comment}{//}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ Because\ we\ want\ the\ UI\ to\ be\ as\ simple\ as\ possible\ to\ write,}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ devs\ dont\ have\ to\ specify\ the\ font\ size\ since\ its\ dynamic\ based\ on\ size.}}
\DoxyCodeLine{00014\ \textcolor{comment}{//}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ This\ means\ that\ like\ size,\ its\ caculated\ every\ frame.\ In\ case\ this\ causes}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ any\ rendering\ lag**,\ we\ need\ some\ way\ of\ caching\ the\ font\ sizes\ given\ a}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ certiain\ (content\ +\ width\ +\ height)}}
\DoxyCodeLine{00018\ \textcolor{comment}{//}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ **\ I\ never\ actually\ noticed\ any\ frame\ drop\ so\ this\ optimization\ was\ premature}}
\DoxyCodeLine{00020\ \textcolor{comment}{//}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ ******************************************************\ start\ kludge}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_f_z_info}{FZInfo}}\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \mbox{\hyperlink{struct_f_z_info_a32dbfd15c59bc281b69c875afd170984}{content}};}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{struct_f_z_info_a56aed3633171326f5a673a7de44ea78c}{width}};}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{struct_f_z_info_a6248542cb93b8f6ecb1e23a0831239f9}{height}};}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{struct_f_z_info_a777652e6916df96815390b8d9013f100}{spacing}};}
\DoxyCodeLine{00028\ \};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacestd}{std}}\ \{}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00033\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacestd_a7ae1fd26dc47e2fdf73cbe73f59de676}{hash\_combine}}(std::size\_t\&\ s,\ \textcolor{keyword}{const}\ T\&\ v)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ std::hash<T>\ h;}
\DoxyCodeLine{00035\ \ \ \ \ s\ \string^=\ h(v)\ +\ 0x9e3779b9\ +\ (s\ <<\ 6)\ +\ (s\ >>\ 2);}
\DoxyCodeLine{00036\ \}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00039\ \textcolor{keyword}{struct\ }std::hash<\mbox{\hyperlink{struct_f_z_info}{FZInfo}}>\ \{}
\DoxyCodeLine{00040\ \ \ \ \ std::size\_t\ \mbox{\hyperlink{structstd_1_1std_1_1hash_3_01_f_z_info_01_4_a134549293712d2d2c8fb130ba818ac83}{operator()}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_f_z_info}{FZInfo}}\&\ info)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }std::hash;}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }std::size\_t;}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ std::size\_t\ out\ =\ 0;}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacestd_a7ae1fd26dc47e2fdf73cbe73f59de676}{hash\_combine}}(out,\ info.\mbox{\hyperlink{struct_f_z_info_a32dbfd15c59bc281b69c875afd170984}{content}});}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacestd_a7ae1fd26dc47e2fdf73cbe73f59de676}{hash\_combine}}(out,\ info.\mbox{\hyperlink{struct_f_z_info_a56aed3633171326f5a673a7de44ea78c}{width}});}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacestd_a7ae1fd26dc47e2fdf73cbe73f59de676}{hash\_combine}}(out,\ info.\mbox{\hyperlink{struct_f_z_info_a6248542cb93b8f6ecb1e23a0831239f9}{height}});}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacestd_a7ae1fd26dc47e2fdf73cbe73f59de676}{hash\_combine}}(out,\ info.\mbox{\hyperlink{struct_f_z_info_a777652e6916df96815390b8d9013f100}{spacing}});}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00051\ \ \ \ \ \}}
\DoxyCodeLine{00052\ \};}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \}\ \ \textcolor{comment}{//\ namespace\ std}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{font__sizer_8h_adeb63fa2568c6fa164361643b1c61775}{operator==}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{struct_f_z_info}{FZInfo}}\&\ info,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_f_z_info}{FZInfo}}\&\ other)\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{return}\ std::hash<FZInfo>()(info)\ ==\ std::hash<FZInfo>()(other);}
\DoxyCodeLine{00058\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{comment}{//\ ******************************************************\ end\ kludge}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_font_size_cache}{FontSizeCache}}\ \{}
\DoxyCodeLine{00063\ \ \ \ \ raylib::Font\ \mbox{\hyperlink{struct_font_size_cache_a496b5fd93368b6f74fd215471314f77b}{font}};}
\DoxyCodeLine{00064\ \ \ \ \ std::unordered\_map<size\_t,\ float>\ \mbox{\hyperlink{struct_font_size_cache_a7bdb1ee23252cb9d667bca403e293ecb}{\_font\_size\_memo}};}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_font_size_cache_a6dec47d3663e069b6cdba660ef1899ce}{init}}()\ \{\ this-\/>\mbox{\hyperlink{struct_font_size_cache_a58f0659e603bfa82816544d92b866f4c}{set\_font}}(Preload::get().\mbox{\hyperlink{namespacefont}{font}});\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_font_size_cache_a58f0659e603bfa82816544d92b866f4c}{set\_font}}(raylib::Font\ f)\ \{\ \mbox{\hyperlink{namespacefont}{font}}\ =\ f;\ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{struct_font_size_cache_a93d126242003fb83738d99dc1566858c}{get\_font\_size\_impl}}(\textcolor{keyword}{const}\ std::string\&\ content,}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ width,\ \textcolor{keywordtype}{float}\ height,}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ spacing)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ font\_size\ =\ 10.0f;}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ last\_size\ =\ 10.0f;}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\ size;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NOTE:\ if\ you\ are\ looking\ at\ a\ way\ to\ speed\ this\ up\ switch\ to\ using}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ powers\ of\ two\ and\ theres\ no\ need\ to\ ceil\ or\ cast\ to\ int.\ also}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ shifting\ (\ font\_size\ <<=\ 1)\ is\ a\ clean\ way\ to\ do\ this}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ lets\ see\ how\ big\ can\ we\ make\ the\ size\ before\ growing}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ outside\ our\ bounds}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ last\_size\ =\ font\_size;}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ smaller\ the\ number\ we\ multiply\ by\ (>1)\ the\ better\ fitting\ the}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ text\ will\ be}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ font\_size\ =\ ceilf(font\_size\ *\ 1.05f);}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{log_8h_af89cb876e6e1d43cfeacdd58a7c9b78c}{log\_trace}}(\textcolor{stringliteral}{"{}measuring\ for\ \{\}"{}},\ font\_size);}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ size\ =\ MeasureTextEx(\mbox{\hyperlink{namespacefont}{font}},\ content.c\_str(),\ font\_size,\ spacing);}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{log_8h_af89cb876e6e1d43cfeacdd58a7c9b78c}{log\_trace}}(\textcolor{stringliteral}{"{}got\ \{\},\{\}\ for\ \{\}\ and\ \{\},\{\}\ and\ last\ was:\ \{\}"{}},\ size.x,}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ size.y,\ font\_size,\ width,\ height,\ last\_size);}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (size.x\ <=\ width\ \&\&\ size.y\ <=\ height);}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ return\ the\ last\ one\ that\ passed}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ last\_size;}
\DoxyCodeLine{00097\ \ \ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{struct_font_size_cache_ac06ce873dae318420f9ae2931ba170b5}{get\_font\_size}}(\textcolor{keyword}{const}\ std::string\&\ content,\ \textcolor{keywordtype}{float}\ width,}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ height,\ \textcolor{keywordtype}{float}\ spacing)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_z_info}{FZInfo}}\ fzinfo\ =}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_f_z_info}{FZInfo}}\{.\mbox{\hyperlink{struct_f_z_info_a32dbfd15c59bc281b69c875afd170984}{content}}\ =\ content,\ .width\ =\ width,\ .height\ =\ height\};}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ hash\ =\ std::hash<FZInfo>()(fzinfo);}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{struct_font_size_cache_a7bdb1ee23252cb9d667bca403e293ecb}{\_font\_size\_memo}}.contains(hash))\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_font_size_cache_a7bdb1ee23252cb9d667bca403e293ecb}{\_font\_size\_memo}}[hash]\ =}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_font_size_cache_a93d126242003fb83738d99dc1566858c}{get\_font\_size\_impl}}(content,\ width,\ height,\ spacing);}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{log_8h_af89cb876e6e1d43cfeacdd58a7c9b78c}{log\_trace}}(\textcolor{stringliteral}{"{}found\ value\ in\ cache"{}});}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ result\ =\ \mbox{\hyperlink{struct_font_size_cache_a7bdb1ee23252cb9d667bca403e293ecb}{\_font\_size\_memo}}[hash];}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{log_8h_af89cb876e6e1d43cfeacdd58a7c9b78c}{log\_trace}}(\textcolor{stringliteral}{"{}cache\ value\ for\ '\{\}'\ was\ \{\}"{}},\ content,\ result);}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00113\ \ \ \ \ \}}
\DoxyCodeLine{00114\ \};}

\end{DoxyCode}
