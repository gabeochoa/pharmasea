\hypertarget{job__system_8h_source}{}\doxysection{job\+\_\+system.\+h}
\label{job__system_8h_source}\index{src/system/job\_system.h@{src/system/job\_system.h}}
\mbox{\hyperlink{job__system_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}../components/can\_be\_ghost\_player.h"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}../components/can\_highlight\_others.h"{}}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}../components/can\_hold\_furniture.h"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}../components/can\_perform\_job.h"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}../components/custom\_item\_position.h"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}../components/transform.h"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}../entity.h"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}../entityhelper.h"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}../vendor\_include.h"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{logging__system_8h}{logging\_system.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacesystem__manager}{system\_manager}}\ \{}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{namespace\ }job\_system\ \{}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{comment}{/*}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ //\ TODO\ eventually\ turn\ this\ back\ on}}
\DoxyCodeLine{00022\ \textcolor{comment}{}}
\DoxyCodeLine{00023\ \textcolor{comment}{inline\ void\ handle\_job\_holder\_pushed(std::shared\_ptr<Entity>\ entity,\ float)\ \{}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ \ \ \ if\ (entity-\/>is\_missing<CanPerformJob>())\ return;}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ \ \ \ CanPerformJob\&\ cpf\ =\ entity-\/>get<CanPerformJob>();}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ \ \ \ if\ (!cpf.has\_job())\ return;}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ \ \ \ auto\ job\ =\ cpf.job();}}
\DoxyCodeLine{00028\ \textcolor{comment}{}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ \ \ \ const\ CanBePushed\&\ cbp\ =\ entity-\/>get<CanBePushed>();}}
\DoxyCodeLine{00030\ \textcolor{comment}{}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ \ \ \ if\ (cbp.pushed\_force().x\ !=\ 0.0f\ ||\ cbp.pushed\_force().z\ !=\ 0.0f)\ \{}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ \ \ \ \ \ \ \ job-\/>path.clear();}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ \ \ \ \ \ \ \ job-\/>local\ =\ \{\};}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ \ \ \ \ \ \ \ SoundLibrary::get().play("{}roblox"{});}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00036\ \textcolor{comment}{\}}}
\DoxyCodeLine{00037\ \textcolor{comment}{}}
\DoxyCodeLine{00038\ \textcolor{comment}{*/}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacesystem__manager_1_1job__system_adc930a9721c3daf854c661ec1905d357}{render\_job\_visual}}(std::shared\_ptr<Entity>\ entity,\ \textcolor{keywordtype}{float})\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>is\_missing<\mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}>())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ box\_size\ =\ \mbox{\hyperlink{globals_8h_af3c09b249c48587aba215cce49091fa0}{TILESIZE}}\ /\ 10.f;}
\DoxyCodeLine{00043\ \ \ \ \ entity-\/>get<\mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}>().for\_each\_path\_location(}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ [box\_size](\mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\ location)\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ DrawCube(\mbox{\hyperlink{namespacevec_a234aab197b01eb9b8f9163149e410399}{vec::to3}}(location),\ box\_size,\ box\_size,\ box\_size,\ BLUE);}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacesystem__manager_1_1job__system_a4062abda6494564722d1c6b89d8f85c6}{ensure\_has\_job}}(std::shared\_ptr<Entity>\ entity,\ \textcolor{keywordtype}{float}\ dt)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>is\_missing<\mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}>())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}\&\ cpj\ =\ entity-\/>get<\mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}>();}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{if}\ (cpj.\mbox{\hyperlink{struct_can_perform_job_ab8a1d36d36914317d620f3059e3a42de}{has\_job}}())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ TODO\ handle\ employee\ ai}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ TODO\ handle\ being\ angry\ or\ something}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ TODO\ handle\ paying\ for\ your\ cart}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ IF\ the\ story\ is\ closed\ then\ leave}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacesystem__manager_aae333b079103d5d1c60cd78e91f20516}{sophie}}\ =\ \mbox{\hyperlink{struct_entity_helper_ae413f593eb143db6a670802d43094022}{EntityHelper::getAllWithName}}(\textcolor{stringliteral}{"{}sophie"{}})[0];}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{assert_8h_a265be64fe52e8a92e89a75fe62153aa5}{VALIDATE}}(\mbox{\hyperlink{namespacesystem__manager_aae333b079103d5d1c60cd78e91f20516}{sophie}},\ \textcolor{stringliteral}{"{}there\ should\ always\ be\ a\ sophie"{}});}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacesystem__manager_aae333b079103d5d1c60cd78e91f20516}{sophie}}-\/>get<\mbox{\hyperlink{struct_has_timer}{HasTimer}}>().\mbox{\hyperlink{struct_has_timer_a81ecd82fdba79dd11d51f9acedfe24f5}{store\_is\_closed}}())\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ pos\ =\ entity-\/>get<\mbox{\hyperlink{struct_transform}{Transform}}>().as2();}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ cpj.\mbox{\hyperlink{struct_can_perform_job_a64a39b69e16eb6263cd48e8ce1b84d6a}{update}}(\mbox{\hyperlink{struct_job_a7639db459c16d9e851b1e5dc66b783d8}{Job::create\_job\_of\_type}}(pos,\ \mbox{\hyperlink{graphics_8h_acf64f2c7361f0fc6883a80cb1d698f28}{vec2}}\{\mbox{\hyperlink{globals_8h_aa2d79e41fb2085f3903c93093342e293}{GATHER\_SPOT}},\ \mbox{\hyperlink{globals_8h_aa2d79e41fb2085f3903c93093342e293}{GATHER\_SPOT}}\},}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ JobType::Leaving));}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{auto}\&\ personal\_queue\ =\ cpj.\mbox{\hyperlink{struct_can_perform_job_a3dd96482c4a5a6b0a97ace0f02962620}{job\_queue}}();}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{if}\ (personal\_queue.empty())\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ job\ and\ nothing\ in\ the\ queue?\ grab\ the\ next\ default\ one\ then}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ pos\ =\ entity-\/>get<\mbox{\hyperlink{struct_transform}{Transform}}>().as2();}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ cpj.\mbox{\hyperlink{struct_can_perform_job_a64a39b69e16eb6263cd48e8ce1b84d6a}{update}}(\mbox{\hyperlink{struct_job_a7639db459c16d9e851b1e5dc66b783d8}{Job::create\_job\_of\_type}}(pos,\ pos,\ cpj.\mbox{\hyperlink{struct_can_perform_job_a119ca4c6de9f3fc86b3c67da69b3902c}{get\_next\_job\_type}}()));}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO\ i\ really\ want\ to\ not\ return\ right\ here\ but\ the\ job\ is}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ nullptr\ if\ i\ do}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{assert_8h_a265be64fe52e8a92e89a75fe62153aa5}{VALIDATE}}(!personal\_queue.empty(),}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}no\ way\ personal\ job\ queue\ should\ be\ empty"{}});}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ queue\ should\ definitely\ have\ something\ by\ now}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ add\ the\ thing\ from\ the\ queue\ as\ our\ job\ :)}}
\DoxyCodeLine{00082\ \ \ \ \ cpj.\mbox{\hyperlink{struct_can_perform_job_a64a39b69e16eb6263cd48e8ce1b84d6a}{update}}(personal\_queue.top().get());}
\DoxyCodeLine{00083\ \ \ \ \ personal\_queue.pop();}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacesystem__manager_1_1job__system_a2451d64a75f037c4c3446e283f93ed71}{run\_job\_tick}}(\textcolor{keyword}{const}\ std::shared\_ptr<Entity>\&\ entity,\ \textcolor{keywordtype}{float}\ dt)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>is\_missing<\mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}>())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00088\ \ \ \ \ entity-\/>get<\mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}>().run\_tick(entity,\ dt);}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacesystem__manager_1_1job__system_abef3d2f4e1dfb4eae41dbcc0585d358b}{cleanup\_completed\_job}}(\textcolor{keyword}{const}\ std::shared\_ptr<Entity>\&\ entity,}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float})\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ TODO\ probably\ can\ just\ live\ in\ 'in\_round\_update'?}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>is\_missing<\mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}>())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00095\ \ \ \ \ entity-\/>get<\mbox{\hyperlink{struct_can_perform_job}{CanPerformJob}}>().cleanup\_if\_completed();}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacesystem__manager_1_1job__system_a683db36d0a63ed50f780384c7060a36b}{in\_round\_update}}(\textcolor{keyword}{const}\ std::shared\_ptr<Entity>\&\ entity,\ \textcolor{keywordtype}{float}\ dt)\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{namespacesystem__manager_1_1job__system_abef3d2f4e1dfb4eae41dbcc0585d358b}{cleanup\_completed\_job}}(entity,\ dt);}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{namespacesystem__manager_1_1job__system_a4062abda6494564722d1c6b89d8f85c6}{ensure\_has\_job}}(entity,\ dt);}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{namespacesystem__manager_1_1job__system_a2451d64a75f037c4c3446e283f93ed71}{run\_job\_tick}}(entity,\ dt);}
\DoxyCodeLine{00102\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \}\ \ \textcolor{comment}{//\ namespace\ job\_system}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \}\ \ \textcolor{comment}{//\ namespace\ system\_manager}}

\end{DoxyCode}
